{% extends 'base.html' %}
{% load static %}

<!-- BEGIN FILTERS BLOCK FOR MOBILE DEVICES -->
{% block filtersmobile %}

<style> 

  .mobile {
    width: 50%;
    margin-left: 25%;
  }

  .mobile-husky-btn {
    width: 100%; 
    margin-bottom: 20px;
  }

  .mobile-husky-color-btn {
    width: 100%; 
    margin-bottom: 20px; 
    background-color: #ffc107; 
    color: black;
  }

</style>

<div class="mobile">
  {% for filter in filters %}
  <form id="{{ filter|cut:' ' }}Form" action="/catalog/filter" method="get" onsubmit="return {{ filter|cut:' ' }}Submit();">

  {% if filter.category_name in curFilters %}
  <button type="submit" id="{{ filter|cut:' ' }}Button" name="filter" value="{{filter.category_name}}" class="btn btn-outline-warning mobile-husky-color-btn">{{filter.category_name}}</button>
  {% else %}
  <button type="submit"  id="{{ filter|cut:' ' }}Button" name="filter" value="{{filter.category_name}}" class="btn btn-outline-warning mobile-husky-btn">{{filter.category_name}}</button>
  {% endif %}
  </form>

  <!-- Filter/search dual functionality -->
  <script type="text/javascript">
    // Cancel the submit form (which overrides the url)
    function {{ filter|cut:' ' }}Submit() {
      search{{ filter|cut:' ' }}();

      //check if the url has any search
      var url = new URL(window.location.href.toString());
      if(url.toString().includes("search=")) {
        // has search paramater
        // do not proceed with normal get request
        return false;
      } else {
        // proceed with normal get request
        return true;
      }
    }

    // set the correct url
    function search{{  filter|cut:' '  }}() {
      filter = document.getElementById("{{ filter|cut:' ' }}Button").value;
      appendToUrl('filter', filter);
    }
  </script>

  {% endfor %}

  <a type="button" class="btn btn-outline-warning husky-btn" href="{% url 'catalog:index' %}">Clear Filters</a>
</div>
{% endblock %}
<!-- END FILTERS BLOCK FOR MOBILE DEVICES -->


<!-- MAIN CONTENT STARTS HERE -->

{% block content %}

<style> 

  .husky-btn {
    width: 100%; 
    margin-bottom: 20px;
  }

  .husky-color-btn {
    width: 100%; 
    margin-bottom: 20px; 
    background-color: #ffc107; 
    color: black;
  }

  .width {
    width: 100%;
  }

  .align {
    text-align: center;
  }

  .inline {
    display: inline-block;
  }

  .husky-col {
    position: static;
    height: 100%;
  }

  .failed-search {
    background-color: black; 
    border: 2px solid black; 
    border-spacing: 10px; 
    text-align: center; 
    margin-bottom: 20px; 
    margin-top: 10px;
  }

  .failed-search-header {
    color: #ffcd00; 
    margin-top: 3px; 
    margin-bottom: 1.5px;
  }

  .failed-search-body {
    color: #ffcd00; 
    margin-top: 1.5px; 
    margin-bottom: 3px;
  }

  .margin-zero {
    margin: 0px;
  }

  .margin-top {
    margin-top: 20px;
  }

  .invis {
    visibility: hidden; 
    height: 0px;
  }

  .inline-margin {
    display: inline-block; 
    margin-left: 20px;
  }

  .page-style {
    display: flex; 
    justify-content: center; 
    align-items: center;
  }

  .page-num {
    padding: 20px; 
    color: var(--main-itemTitle-color);
  }

</style>

<div class="row width">
  <!--Aligns all the contents of the side bar to the center, and fixes the size of the col the side bar in in -->
 <div class="main-split col align-center">
  <div class="wrapper">
    <!--Fixes the size of the side bar so it doent grow or shink. -->
    <div id="sidebar">
      <div class="sidebar-header">
        <h1 id="title" class="my-4 align">Catalog</h1>
      </div>
      <div class="inline">

       {% for filter in filters %}
          <form id="{{ filter|cut:' ' }}Form" action="/catalog/filter" method="get" onsubmit="return {{ filter|cut:' ' }}Submit();">

          {% if filter.category_name in curFilters %}
          <button type="submit" id="{{ filter|cut:' ' }}Button" name="filter" value="{{filter.category_name}}" class="btn btn-outline-warning husky-color-btn">{{filter.category_name}}</button>
          {% else %}
          <button type="submit"  id="{{ filter|cut:' ' }}Button" name="filter" value="{{filter.category_name}}" class="btn btn-outline-warning husky-btn">{{filter.category_name}}</button>
          {% endif %}
           </form>

          <!-- Filter/search dual functionality -->
          <script type="text/javascript">
            // Cancel the submit form (which overrides the url)
            function {{ filter|cut:' ' }}Submit() {
              search{{ filter|cut:' ' }}();

              //check if the url has any search
              var url = new URL(window.location.href.toString());
              if(url.toString().includes("search=")) {
                // has search paramater
                // do not proceed with normal get request
                return false;
              } else {
                // proceed with normal get request
                return true;
              }
            }

            // set the correct url
            function search{{  filter|cut:' '  }}() {
              filter = document.getElementById("{{ filter|cut:' ' }}Button").value;
              appendToUrl('filter', filter);
            }
          </script>

        {% endfor %}

        <a type="button" class="btn btn-outline-warning husky-btn" href="{% url 'catalog:index' %}">Clear Filters</a>
      </div>
    </div>
  </div>
</div>


    <!-- /.col-lg-3 -->
    <div class="col husky-col">
      <div class="sidebar-header pgtitle-mobile">
        <h1 id="title" class="my-4 align">Catalog</h1>
      </div>

      {% if failed_search %}
        <div class="failed-search">
            <h1 class="failed-search-header">Oops!</h1>
            <h6 class="failed-search-body">

              {% if failed_search == 'MisformedFilterFail' %}
              Seems like one of your filters isn't valid, so we couldn't find any results.
              <br>Please <a href="{% url 'catalog:index' %}" >return to</a> the catalog, then select filters from the sidebar.
              {% elif failed_search == 'FilterFail' %}
              Looks like no items have been uploaded for {% if curFilters|length > 1 %} those categories{% else %}that category{% endif %}. But here are some recently-uploaded items instead!
              {% elif failed_search == 'PageNotFoundFail' %}
              Looks like that item couldn't be found. But here are some recently-uploaded items instead!
              {% elif failed_search == 'SearchFail' %}
              Looks like no items could be found for your search. But here are some recently-uploaded items instead!
              {% else %}
              Looks like something went wrong. Please contact MTU HuskyHunt if this error persists.
              {% endif %}

            </h6>
        </div>
      {% endif %}
      <!-- -->

        <div class="row margin-zero">
            {% if items %}
            {% for item in items %}
            <div class="col col-xl-3 col-lg-4 col-md-6 col-sm-12 justify-content-center catalog-item-wrap">
                <div class="card h-100 husky-card">
                    <a href="\catalog\{{item.id}}"><img class="product-icon" src="{% if item.item_picture is not None %}{{item.item_picture.url}}{% else %}{% static 'mainsite/images/imagenotfound.png' %}{% endif %}" alt=""></a>
                    <div class="card-body">
                        <h3 class="card-title">
                          <div class="custom-tooltip">
                            <div class="text-overflow">
                                <a id="itemTitle" href="\catalog\{{item.id}}">{{ item.item_title }}</a>
                            </div>
                            <span class="custom-tooltiptext">{{item.item_title}}</span>
                          </div>
                        </h3>

                        <h4>${{ item.item_price }}</h4>
                        <h6>Seller: {{ item.first_name }}</h6>
                        <!--
                        <div style="width: auto; text-overflow: ellipsis; white-space: nowrap; overflow: hidden;">
                            <p class="card-text">{{ item.item_description }}</p>
                        </div>
                    -->
                    </div>
                </div>
            </div>
        {% endfor %}
          <div class="col col-xl-3 col-lg-4 col-md-6 col-sm-12 justify-content-center catalog-item-wrap invis">
                <div class="card h-100 husky-card">
                    <div class="card-body">
                        <h3 class="card-title">
                            <div class="text-overflow">
                                <a id="itemTitle">xxxxxxxxxxxxxxxxxxxx</a>
                            </div>
                        </h3>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

{% if items.paginator.num_pages > 1 %}
    <div class="pagination page-style">
        <span class="step-links margin-top">
            {% if items.has_previous %}
            <button type="button" class="btn btn-link husky-button-light inline-margin" onclick="appendToUrl('page', '1')">
            &laquo; first
            </button>

            <button type="button" class="btn btn-link husky-button-light inline" onclick="appendToUrl('page', '{{ items.previous_page_number }}')">
            previous
            </button>
            {% endif %}

            <span class="page-num">
                Page {{ items.number }} of {{ items.paginator.num_pages }}.
            </span>

            {% if items.has_next %}
            <button type="button" class="btn btn-link husky-button-light inline" onclick="appendToUrl('page', '{{ items.next_page_number }}')">
            next
            </button>

            <button type="button" class="btn btn-link husky-button-light inline-margin" onclick="appendToUrl('page', '{{ items.paginator.num_pages }}')">
            last &raquo;
            </button>

            {% endif %}
        </span>
    </div>
{% endif %}

      <div class="row page-style">
        <div class="disclaimer">
          <p>
            <br/>For issues regarding the website, please contact our development team at <a href="mailto:huskyhunt-l@mtu.edu">huskyhunt-l@mtu.edu</a>
          </p>
        </div>
     </div>
  </div>

  {% block devContact %}
  <!-- Empty block, want to center and not use default bottom -->
  {% endblock %}

</div>

{% endblock %}
